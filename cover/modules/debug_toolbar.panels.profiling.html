<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
    <title>Test coverage report: debug_toolbar.panels.profiling</title>
    <style type="text/css" media="screen">
      a
      {
        color: #3d707a;
      }
      
      a:hover, a:active
      {
        color: #bf7d18;
      }
    
      body 
      {
        font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        font-size: 13px;
      }
      
      .nav 
      {
        font-size: 12px;
        margin-left: 50px;
      }

      .ignored
      {
        color: #707070;
      }

      .executed 
      {
        color: #3d9900;
      }

      .missed 
      {
        color: red;
        font-weight: bold;
      }

      .excluded 
      {
        color: #6090f0;
        font-weight: lighter;
      }
    
      #content-header 
      {
        font-size: 12px;
        padding: 18px 0 18px 50px;
      }

      #content-header h1 
      {
        font-size: 16px;
        margin: 10px 0 0 0;
        color: #909090;
      }
      
      #module-name
      {
        color: #583707;
      }
    
      #content-header p
      {
        font-size: 13px;
        margin: 0;
        color: #909090;
      }

      #content-header .normal 
      {
        color: #609030;
      }

      #content-header .warning 
      {
        color: #d0a000;
      }

      #content-header .critical 
      {
        color: red;
      }
      
      #source-listing 
      {
        margin-bottom: 24px;
      }

      #source-listing ol 
      {
        padding: 0 0 0 50px;
        width: 90%;
        font-family: monospace;
        list-style-position: outside;
      }

      #source-listing ol li 
      {
        line-height: 18px;
        font-size: small;
      }
        
      #source-listing ol code 
      {
        padding:  0 .001em 0 0; /* Firefox doesn't render empty li's properly */
        font-size: medium;
        white-space: pre;
      }
   </style>
  </head>

  <body>

<div class="nav">
  <a href="debug_toolbar.panels.logging.html">debug_toolbar.panels.logging</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="debug_toolbar.panels.redirects.html">debug_toolbar.panels.redirects</a>
</div>

<div id="content-header">
  <h1>
    <span id="module-name">debug_toolbar.panels.profiling</span>:
    102 total statements,
    <span class="critical">0.0% covered</span>
  </h1>
  <p>Generated: Thu 2015-05-07 01:13 UTC</p>
  <p>Source file: /usr/local/lib/python2.7/dist-packages/debug_toolbar/panels/profiling.py</p>
  <p>
    Stats:
    <span class="executed">0 executed</span>,
    <span class="missed">93 missed</span>,
    <span class="excluded">9 excluded</span>,
    <span class="ignored">59 ignored</span> 
  </p> 
</div>

<div id="source-listing">
  <ol>
    <li class="excluded"><code>from __future__ import absolute_import, division, unicode_literals</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>from django.utils.translation import ugettext_lazy as _</code></li>
<li class="excluded"><code>from django.utils.safestring import mark_safe</code></li>
<li class="excluded"><code>from debug_toolbar.panels import Panel</code></li>
<li class="excluded"><code>from debug_toolbar import settings as dt_settings</code></li>
<li class="ignored"><code></code></li>
<li class="excluded"><code>import cProfile</code></li>
<li class="excluded"><code>from pstats import Stats</code></li>
<li class="excluded"><code>from colorsys import hsv_to_rgb</code></li>
<li class="excluded"><code>import os</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class DjangoDebugToolbarStats(Stats):</code></li>
<li class="missed"><code>    __root = None</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def get_root_func(self):</code></li>
<li class="missed"><code>        if self.__root is None:</code></li>
<li class="missed"><code>            for func, (cc, nc, tt, ct, callers) in self.stats.items():</code></li>
<li class="missed"><code>                if len(callers) == 0:</code></li>
<li class="missed"><code>                    self.__root = func</code></li>
<li class="missed"><code>                    break</code></li>
<li class="missed"><code>        return self.__root</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class FunctionCall(object):</code></li>
<li class="missed"><code>    def __init__(self, statobj, func, depth=0, stats=None,</code></li>
<li class="ignored"><code>                 id=0, parent_ids=[], hsv=(0, 0.5, 1)):</code></li>
<li class="missed"><code>        self.statobj = statobj</code></li>
<li class="missed"><code>        self.func = func</code></li>
<li class="missed"><code>        if stats:</code></li>
<li class="missed"><code>            self.stats = stats</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            self.stats = statobj.stats[func][:4]</code></li>
<li class="missed"><code>        self.depth = depth</code></li>
<li class="missed"><code>        self.id = id</code></li>
<li class="missed"><code>        self.parent_ids = parent_ids</code></li>
<li class="missed"><code>        self.hsv = hsv</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def parent_classes(self):</code></li>
<li class="missed"><code>        return self.parent_classes</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def background(self):</code></li>
<li class="missed"><code>        r, g, b = hsv_to_rgb(*self.hsv)</code></li>
<li class="missed"><code>        return 'rgb(%f%%,%f%%,%f%%)' % (r * 100, g * 100, b * 100)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def func_std_string(self):  # match what old profile produced</code></li>
<li class="missed"><code>        func_name = self.func</code></li>
<li class="missed"><code>        if func_name[:2] == ('~', 0):</code></li>
<li class="ignored"><code>            # special case for built-in functions</code></li>
<li class="missed"><code>            name = func_name[2]</code></li>
<li class="missed"><code>            if name.startswith('&lt;') and name.endswith('&gt;'):</code></li>
<li class="missed"><code>                return '{%s}' % name[1:-1]</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                return name</code></li>
<li class="ignored"><code>        else:</code></li>
<li class="missed"><code>            file_name, line_num, method = self.func</code></li>
<li class="missed"><code>            idx = file_name.find('/site-packages/')</code></li>
<li class="missed"><code>            if idx &gt; -1:</code></li>
<li class="missed"><code>                file_name = file_name[(idx + 14):]</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>            file_path, file_name = file_name.rsplit(os.sep, 1)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>            return mark_safe(</code></li>
<li class="ignored"><code>                '&lt;span class="djdt-path"&gt;{0}/&lt;/span&gt;'</code></li>
<li class="ignored"><code>                '&lt;span class="djdt-file"&gt;{1}&lt;/span&gt;'</code></li>
<li class="ignored"><code>                ' in &lt;span class="djdt-func"&gt;{3}&lt;/span&gt;'</code></li>
<li class="ignored"><code>                '(&lt;span class="djdt-lineno"&gt;{2}&lt;/span&gt;)'.format(</code></li>
<li class="ignored"><code>                    file_path,</code></li>
<li class="ignored"><code>                    file_name,</code></li>
<li class="ignored"><code>                    line_num,</code></li>
<li class="ignored"><code>                    method))</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def subfuncs(self):</code></li>
<li class="missed"><code>        i = 0</code></li>
<li class="missed"><code>        h, s, v = self.hsv</code></li>
<li class="missed"><code>        count = len(self.statobj.all_callees[self.func])</code></li>
<li class="missed"><code>        for func, stats in self.statobj.all_callees[self.func].items():</code></li>
<li class="missed"><code>            i += 1</code></li>
<li class="missed"><code>            h1 = h + (i / count) / (self.depth + 1)</code></li>
<li class="missed"><code>            if stats[3] == 0:</code></li>
<li class="missed"><code>                s1 = 0</code></li>
<li class="ignored"><code>            else:</code></li>
<li class="missed"><code>                s1 = s * (stats[3] / self.stats[3])</code></li>
<li class="missed"><code>            yield FunctionCall(self.statobj,</code></li>
<li class="ignored"><code>                               func,</code></li>
<li class="ignored"><code>                               self.depth + 1,</code></li>
<li class="ignored"><code>                               stats=stats,</code></li>
<li class="ignored"><code>                               id=str(self.id) + '_' + str(i),</code></li>
<li class="ignored"><code>                               parent_ids=self.parent_ids + [self.id],</code></li>
<li class="ignored"><code>                               hsv=(h1, s1, 1))</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def count(self):</code></li>
<li class="missed"><code>        return self.stats[1]</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def tottime(self):</code></li>
<li class="missed"><code>        return self.stats[2]</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def cumtime(self):</code></li>
<li class="missed"><code>        cc, nc, tt, ct = self.stats</code></li>
<li class="missed"><code>        return self.stats[3]</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def tottime_per_call(self):</code></li>
<li class="missed"><code>        cc, nc, tt, ct = self.stats</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        if nc == 0:</code></li>
<li class="missed"><code>            return 0</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return tt / nc</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def cumtime_per_call(self):</code></li>
<li class="missed"><code>        cc, nc, tt, ct = self.stats</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        if cc == 0:</code></li>
<li class="missed"><code>            return 0</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        return ct / cc</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def indent(self):</code></li>
<li class="missed"><code>        return 16 * self.depth</code></li>
<li class="ignored"><code></code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>class ProfilingPanel(Panel):</code></li>
<li class="ignored"><code>    """</code></li>
<li class="ignored"><code>    Panel that displays profiling information.</code></li>
<li class="ignored"><code>    """</code></li>
<li class="missed"><code>    title = _("Profiling")</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    template = 'debug_toolbar/panels/profiling.html'</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def process_view(self, request, view_func, view_args, view_kwargs):</code></li>
<li class="missed"><code>        self.profiler = cProfile.Profile()</code></li>
<li class="missed"><code>        args = (request,) + view_args</code></li>
<li class="missed"><code>        return self.profiler.runcall(view_func, *args, **view_kwargs)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def add_node(self, func_list, func, max_depth, cum_time=0.1):</code></li>
<li class="missed"><code>        func_list.append(func)</code></li>
<li class="missed"><code>        func.has_subfuncs = False</code></li>
<li class="missed"><code>        if func.depth &lt; max_depth:</code></li>
<li class="missed"><code>            for subfunc in func.subfuncs():</code></li>
<li class="missed"><code>                if subfunc.stats[3] &gt;= cum_time:</code></li>
<li class="missed"><code>                    func.has_subfuncs = True</code></li>
<li class="missed"><code>                    self.add_node(func_list, subfunc, max_depth, cum_time=cum_time)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>    def process_response(self, request, response):</code></li>
<li class="missed"><code>        if not hasattr(self, 'profiler'):</code></li>
<li class="missed"><code>            return None</code></li>
<li class="ignored"><code>        # Could be delayed until the panel content is requested (perf. optim.)</code></li>
<li class="missed"><code>        self.profiler.create_stats()</code></li>
<li class="missed"><code>        self.stats = DjangoDebugToolbarStats(self.profiler)</code></li>
<li class="missed"><code>        self.stats.calc_callees()</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        root = FunctionCall(self.stats, self.stats.get_root_func(), depth=0)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        func_list = []</code></li>
<li class="missed"><code>        self.add_node(func_list,</code></li>
<li class="ignored"><code>                      root,</code></li>
<li class="ignored"><code>                      dt_settings.CONFIG['PROFILER_MAX_DEPTH'],</code></li>
<li class="ignored"><code>                      root.stats[3] / 8)</code></li>
<li class="ignored"><code></code></li>
<li class="missed"><code>        self.record_stats({'func_list': func_list})</code></li>
  </ol>
</div>

<div class="nav">
  <a href="debug_toolbar.panels.logging.html">debug_toolbar.panels.logging</a> &lt;&lt;
  <a href="../index.html">index</a>
  &gt;&gt; <a href="debug_toolbar.panels.redirects.html">debug_toolbar.panels.redirects</a>
</div>

  </body>
</html>

